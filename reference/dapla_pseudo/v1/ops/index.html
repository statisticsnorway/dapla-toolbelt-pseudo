
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Pseudonymization extensions for Dapla Toolbelt">
      
      
      
        <link rel="canonical" href="https://statisticsnorway.github.io/dapla-toolbelt-pseudo/reference/dapla_pseudo/v1/ops/">
      
      
        <link rel="prev" href="../models/">
      
      
        <link rel="next" href="../supported_file_format/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>ops - dapla-toolbelt-pseudo</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dapla_pseudo.v1.ops" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="dapla-toolbelt-pseudo" class="md-header__button md-logo" aria-label="dapla-toolbelt-pseudo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dapla-toolbelt-pseudo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ops
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/statisticsnorway/dapla-toolbelt-pseudo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    statisticsnorway/dapla-toolbelt-pseudo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="dapla-toolbelt-pseudo" class="md-nav__button md-logo" aria-label="dapla-toolbelt-pseudo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    dapla-toolbelt-pseudo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/statisticsnorway/dapla-toolbelt-pseudo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    statisticsnorway/dapla-toolbelt-pseudo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    dapla_pseudo
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            dapla_pseudo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constants/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    constants
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exceptions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_6" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    v1
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_6" id="__nav_2_1_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_6">
            <span class="md-nav__icon md-icon"></span>
            v1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builder_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    builder_models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builder_pseudo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    builder_pseudo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builder_validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    builder_validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ops
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ops
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops" class="md-nav__link">
    <span class="md-ellipsis">
      ops
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops.depseudonymize" class="md-nav__link">
    <span class="md-ellipsis">
      depseudonymize()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops.pseudonymize" class="md-nav__link">
    <span class="md-ellipsis">
      pseudonymize()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops.repseudonymize" class="md-nav__link">
    <span class="md-ellipsis">
      repseudonymize()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../supported_file_format/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    supported_file_format
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../CONTRIBUTING.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops" class="md-nav__link">
    <span class="md-ellipsis">
      ops
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops.depseudonymize" class="md-nav__link">
    <span class="md-ellipsis">
      depseudonymize()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops.pseudonymize" class="md-nav__link">
    <span class="md-ellipsis">
      pseudonymize()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dapla_pseudo.v1.ops.repseudonymize" class="md-nav__link">
    <span class="md-ellipsis">
      repseudonymize()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>ops</h1>

<div class="doc doc-object doc-module">



<a id="dapla_pseudo.v1.ops"></a>
  <div class="doc doc-contents first">
  
      <p>Pseudonymization operations provided to Dapla end users.</p>
<p>These operations aim to simplify the way Dapla users interact with the Dapla pseudo service. While the Dapla pseudo
service API offers many advanced options, like detailed configuration of pseudo rules on a field-basis targeting
hierarchical data structures, many users will be just fine with using one key and just listing the fields (of their
flat data).</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="dapla_pseudo.v1.ops.depseudonymize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">depseudonymize</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT_DEFAULT</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Depseudonymize specified fields of a local file.</p>
<p>This is the inverse operation of "pseudonymize". Special privileges will be required (e.g. only whitelisted users)
will be allowed to depseudonymize data.</p>
<p>Supported file formats: csv and json (both standard and "new line delimited" json)</p>
<p>You can alternatively send a zip-file containing one or many files of the supported file formats. The pseudo service
will unzip and process them sequentially. This can be handy if your file is large and/or split into multiple files.</p>
<p>The <code>fields</code> list specifies what to pseudonymize. This can either be a plain vanilla list of field names (e.g.
<code>["some_field1", "another_field2"]</code>, or you can apply ninja-style techniques, such as using wildcard characters
(e.g. <em>Name) or slashes to target hierarchical fields (e.g. </em>*/path/to/hierarchicalStuff).</p>
<p>Pseudonymize uses the tink-daead crypto function underneath the hood. It requires a key.
You can choose to specify one of the predefined ("globally available") keys ("ssb-common-key-1" or
"ssb-common-key-2") or provide your own custom keyset. If you don't specify a key, the predefined "ssb-common-key-1"
will be used as default.</p>
<p>It is possible to operate on the file in a streaming manner, e.g. like so:</p>
<p>.. code-block:: python</p>
<pre><code>with depseudonymize("./data/personer.json", fields=["fnr", "fornavn", "etternavn"], stream=True) as res:
    with open("./data/personer_deid.json", 'wb') as f:
        shutil.copyfileobj(res.raw, f)
</code></pre>
<p>:param file_path: path to a local file, e.g. ./path/to/data-deid.json. Supported file formats: csv, json
:param fields: list of fields that should be depseudonymized
:param key: either named reference to a "global" key or a keyset json
:param timeout: connection and read timeout, see
    https://requests.readthedocs.io/en/latest/user/advanced/?highlight=timeout#timeouts
:param stream: true if the results should be chunked into pieces (use for large data)
:return: depseudonymized data</p>

          <details class="quote">
            <summary>Source code in <code>dapla_pseudo/v1/ops.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">depseudonymize</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">FieldDecl</span><span class="p">],</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PseudoKeyset</span><span class="p">]</span> <span class="o">=</span> <span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TIMEOUT_DEFAULT</span><span class="p">,</span>
    <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Depseudonymize specified fields of a local file.</span>

<span class="sd">    This is the inverse operation of &quot;pseudonymize&quot;. Special privileges will be required (e.g. only whitelisted users)</span>
<span class="sd">    will be allowed to depseudonymize data.</span>

<span class="sd">    Supported file formats: csv and json (both standard and &quot;new line delimited&quot; json)</span>

<span class="sd">    You can alternatively send a zip-file containing one or many files of the supported file formats. The pseudo service</span>
<span class="sd">    will unzip and process them sequentially. This can be handy if your file is large and/or split into multiple files.</span>

<span class="sd">    The ``fields`` list specifies what to pseudonymize. This can either be a plain vanilla list of field names (e.g.</span>
<span class="sd">    ``[&quot;some_field1&quot;, &quot;another_field2&quot;]``, or you can apply ninja-style techniques, such as using wildcard characters</span>
<span class="sd">    (e.g. *Name) or slashes to target hierarchical fields (e.g. **/path/to/hierarchicalStuff).</span>

<span class="sd">    Pseudonymize uses the tink-daead crypto function underneath the hood. It requires a key.</span>
<span class="sd">    You can choose to specify one of the predefined (&quot;globally available&quot;) keys (&quot;ssb-common-key-1&quot; or</span>
<span class="sd">    &quot;ssb-common-key-2&quot;) or provide your own custom keyset. If you don&#39;t specify a key, the predefined &quot;ssb-common-key-1&quot;</span>
<span class="sd">    will be used as default.</span>

<span class="sd">    It is possible to operate on the file in a streaming manner, e.g. like so:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        with depseudonymize(&quot;./data/personer.json&quot;, fields=[&quot;fnr&quot;, &quot;fornavn&quot;, &quot;etternavn&quot;], stream=True) as res:</span>
<span class="sd">            with open(&quot;./data/personer_deid.json&quot;, &#39;wb&#39;) as f:</span>
<span class="sd">                shutil.copyfileobj(res.raw, f)</span>

<span class="sd">    :param file_path: path to a local file, e.g. ./path/to/data-deid.json. Supported file formats: csv, json</span>
<span class="sd">    :param fields: list of fields that should be depseudonymized</span>
<span class="sd">    :param key: either named reference to a &quot;global&quot; key or a keyset json</span>
<span class="sd">    :param timeout: connection and read timeout, see</span>
<span class="sd">        https://requests.readthedocs.io/en/latest/user/advanced/?highlight=timeout#timeouts</span>
<span class="sd">    :param stream: true if the results should be chunked into pieces (use for large data)</span>
<span class="sd">    :return: depseudonymized data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">MimeTypes</span><span class="p">()</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">KeyWrapper</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">_rules_of</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">sid_fields</span><span class="o">=</span><span class="p">[],</span> <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">key_id</span><span class="p">)</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">DepseudonymizeFileRequest</span><span class="p">(</span>
        <span class="n">pseudo_config</span><span class="o">=</span><span class="n">PseudoConfig</span><span class="p">(</span><span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="p">,</span> <span class="n">keysets</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">keyset_list</span><span class="p">()),</span>
        <span class="n">target_content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
        <span class="n">target_uri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">_client</span><span class="p">()</span><span class="o">.</span><span class="n">depseudonymize_file</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="dapla_pseudo.v1.ops.pseudonymize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pseudonymize</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sid_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sid_snapshot_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT_DEFAULT</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Pseudonymize specified fields of a dataset.</p>

<details class="the-dataset-may-be-supplied-as" open>
  <summary>The dataset may be supplied as</summary>
  <ul>
<li>A local file on disk (string or Path)</li>
<li>A file handle (io.BufferedReader)</li>
<li>A Pandas dataframe</li>
</ul>
</details>      <p>Supported file formats: json, csv</p>
<p>The <code>fields</code> and <code>sid_fields</code> lists specify what to pseudonymize. At least one of these fields must be specified.
The list contents can either be plain field names (e.g. <code>["some_field1", "another_field2"]</code>, or you can apply
more advanced techniques, such as using wildcard characters (e.g. <em>Name) or slashes to target hierarchical fields
(e.g. </em>*/path/to/hierarchicalStuff).</p>
<p>For <code>fields</code>, the <code>daead</code> pseudonymization function is used. It requires a key.
You can choose to specify one of the predefined ("globally available") keys ("ssb-common-key-1" or
"ssb-common-key-2") or provide your own custom keyset. If you don't specify a key, the predefined "ssb-common-key-1"
will be used as default.</p>
<p>For <code>sid_fields</code>, the <code>map-sid</code> pseudonymization function is used. This maps a fødselsnummer to a "stabil ID" and
subsequently pseudonymizes the stabil ID using an FPE algorithm. Pseudonyms produced by this function are guaranteed to be
compatible with those produced by the PAPIS project.</p>
<p>It is possible to operate on the file in a streaming manner, e.g. like so:</p>
<p>.. code-block:: python</p>
<pre><code>with pseudonymize("./data/personer.json", fields=["fnr", "fornavn", "etternavn"], stream=True) as res:
    with open("./data/personer.json", 'wb') as f:
        shutil.copyfileobj(res.raw, f)
</code></pre>
<p>:param dataset: path to file, file handle or dataframe
:param fields: list of fields that should be pseudonymized
:param sid_fields: list of fields that should be mapped to stabil ID and pseudonymized
:param sid_snapshot_date: Date representing SID-catalogue version to use. Latest if unspecified. Format: YYYY-MM-DD
:param key: either named reference to a "global" key or a keyset json
:param timeout: connection and read timeout, see
    https://requests.readthedocs.io/en/latest/user/advanced/?highlight=timeout#timeouts
:param stream: true if the results should be chunked into pieces (use for large data)
:return: pseudonymized data</p>

          <details class="quote">
            <summary>Source code in <code>dapla_pseudo/v1/ops.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pseudonymize</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetDecl</span><span class="p">,</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">FieldDecl</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sid_fields</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sid_snapshot_date</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PseudoKeyset</span><span class="p">]</span> <span class="o">=</span> <span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TIMEOUT_DEFAULT</span><span class="p">,</span>
    <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Pseudonymize specified fields of a dataset.</span>

<span class="sd">    The dataset may be supplied as:</span>
<span class="sd">        - A local file on disk (string or Path)</span>
<span class="sd">        - A file handle (io.BufferedReader)</span>
<span class="sd">        - A Pandas dataframe</span>

<span class="sd">    Supported file formats: json, csv</span>

<span class="sd">    The ``fields`` and ``sid_fields`` lists specify what to pseudonymize. At least one of these fields must be specified.</span>
<span class="sd">    The list contents can either be plain field names (e.g. ``[&quot;some_field1&quot;, &quot;another_field2&quot;]``, or you can apply</span>
<span class="sd">    more advanced techniques, such as using wildcard characters (e.g. *Name) or slashes to target hierarchical fields</span>
<span class="sd">    (e.g. **/path/to/hierarchicalStuff).</span>

<span class="sd">    For ``fields``, the ``daead`` pseudonymization function is used. It requires a key.</span>
<span class="sd">    You can choose to specify one of the predefined (&quot;globally available&quot;) keys (&quot;ssb-common-key-1&quot; or</span>
<span class="sd">    &quot;ssb-common-key-2&quot;) or provide your own custom keyset. If you don&#39;t specify a key, the predefined &quot;ssb-common-key-1&quot;</span>
<span class="sd">    will be used as default.</span>

<span class="sd">    For ``sid_fields``, the ``map-sid`` pseudonymization function is used. This maps a fødselsnummer to a &quot;stabil ID&quot; and</span>
<span class="sd">    subsequently pseudonymizes the stabil ID using an FPE algorithm. Pseudonyms produced by this function are guaranteed to be</span>
<span class="sd">    compatible with those produced by the PAPIS project.</span>

<span class="sd">    It is possible to operate on the file in a streaming manner, e.g. like so:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        with pseudonymize(&quot;./data/personer.json&quot;, fields=[&quot;fnr&quot;, &quot;fornavn&quot;, &quot;etternavn&quot;], stream=True) as res:</span>
<span class="sd">            with open(&quot;./data/personer.json&quot;, &#39;wb&#39;) as f:</span>
<span class="sd">                shutil.copyfileobj(res.raw, f)</span>

<span class="sd">    :param dataset: path to file, file handle or dataframe</span>
<span class="sd">    :param fields: list of fields that should be pseudonymized</span>
<span class="sd">    :param sid_fields: list of fields that should be mapped to stabil ID and pseudonymized</span>
<span class="sd">    :param sid_snapshot_date: Date representing SID-catalogue version to use. Latest if unspecified. Format: YYYY-MM-DD</span>
<span class="sd">    :param key: either named reference to a &quot;global&quot; key or a keyset json</span>
<span class="sd">    :param timeout: connection and read timeout, see</span>
<span class="sd">        https://requests.readthedocs.io/en/latest/user/advanced/?highlight=timeout#timeouts</span>
<span class="sd">    :param stream: true if the results should be chunked into pieces (use for large data)</span>
<span class="sd">    :return: pseudonymized data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sid_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one of fields and sid_fields must be specified.&quot;</span><span class="p">)</span>

    <span class="c1"># Avoid later type errors by making sure we have lists</span>
    <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">sid_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sid_fields</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">file_handle</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">BinaryFileDecl</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">match</span> <span class="n">dataset</span><span class="p">:</span>
        <span class="k">case</span> <span class="nb">str</span><span class="p">()</span> <span class="o">|</span> <span class="n">Path</span><span class="p">():</span>
            <span class="c1"># File path</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">Mimetypes</span><span class="p">(</span><span class="n">magic</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">mime</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">case</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">():</span>
            <span class="c1"># Dataframe</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">Mimetypes</span><span class="o">.</span><span class="n">JSON</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="n">_dataframe_to_json</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">sid_fields</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">():</span>
            <span class="c1"># File handle</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">Mimetypes</span><span class="p">(</span><span class="n">magic</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2048</span><span class="p">),</span> <span class="n">mime</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="n">dataset</span>
        <span class="k">case</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">AbstractBufferedFile</span><span class="p">():</span>
            <span class="c1"># This is a file handle to a remote storage system such as GCS.</span>
            <span class="c1"># It provides random access for the underlying file-like data (without downloading the whole thing).</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">Mimetypes</span><span class="p">(</span><span class="n">magic</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2048</span><span class="p">),</span> <span class="n">mime</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">file_handle</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported data type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">. Supported types are </span><span class="si">{</span><span class="n">DatasetDecl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">KeyWrapper</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">sid_func_kwargs</span> <span class="o">=</span> <span class="n">MapSidKeywordArgs</span><span class="p">(</span><span class="n">snapshot_date</span><span class="o">=</span><span class="n">convert_to_date</span><span class="p">(</span><span class="n">sid_snapshot_date</span><span class="p">))</span> <span class="k">if</span> <span class="n">sid_fields</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">_rules_of</span><span class="p">(</span>
        <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
        <span class="n">sid_fields</span><span class="o">=</span><span class="n">sid_fields</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">key_id</span><span class="p">,</span>
        <span class="n">sid_func_kwargs</span><span class="o">=</span><span class="n">sid_func_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">pseudonymize_request</span> <span class="o">=</span> <span class="n">PseudonymizeFileRequest</span><span class="p">(</span>
        <span class="n">pseudo_config</span><span class="o">=</span><span class="n">PseudoConfig</span><span class="p">(</span><span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="p">,</span> <span class="n">keysets</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">keyset_list</span><span class="p">()),</span>
        <span class="n">target_content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
        <span class="n">target_uri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">file_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_client</span><span class="p">()</span><span class="o">.</span><span class="n">pseudonymize_file</span><span class="p">(</span><span class="n">pseudonymize_request</span><span class="p">,</span> <span class="n">file_handle</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_client</span><span class="p">()</span><span class="o">.</span><span class="n">_process_file</span><span class="p">(</span>
            <span class="s2">&quot;pseudonymize&quot;</span><span class="p">,</span>
            <span class="n">pseudonymize_request</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span>
            <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="dapla_pseudo.v1.ops.repseudonymize" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">repseudonymize</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">source_key</span><span class="o">=</span><span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT_DEFAULT</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Repseudonymize specified fields of a local, previously pseudonymized file.</p>
<p>You will need to provide a crypto key for both the source data and a key that should be used for
re-pseudonymization.</p>
<p>Supported file formats: csv and json (both standard and "new line delimited" json)</p>
<p>You can alternatively send a zip-file containing one or many files of the supported file formats. The pseudo service
will unzip and process them sequentially. This can be handy if your file is large and/or split into multiple files.</p>
<p>The <code>fields</code> list specifies what to repseudonymize. This can either be a plain vanilla list of field names (e.g.
<code>["some_field1", "another_field2"]</code>, or you can apply ninja-style techniques, such as using wildcard characters
(e.g. <em>Name) or slashes to target hierarchical fields (e.g. </em>*/path/to/hierarchicalStuff).</p>
<p>Pseudonymize uses the tink-daead crypto function underneath the hood. It requires a key.
You can choose to specify one of the predefined ("globally available") keys ("ssb-common-key-1" or
"ssb-common-key-2") or provide your own custom keyset. If you don't specify a key, the predefined "ssb-common-key-1"
will be used as default.</p>
<p>It is possible to operate on the file in a streaming manner, e.g. like so:</p>
<p>.. code-block:: python</p>
<pre><code>with repseudonymize("./data/personer-deid.json", fields=["fnr", "fornavn", "etternavn"], stream=True) as res:
    with open("./data/personer.json", 'wb') as f:
        shutil.copyfileobj(res.raw, f)
</code></pre>
<p>:param file_path: path to a local file, e.g. ./path/to/data.json. Supported file formats: csv, json
:param fields: list of fields that should be pseudonymized
:param source_key: either named reference to a "global" key or a keyset json - used for depseudonymization
:param target_key: either named reference to a "global" key or a keyset json - used for pseudonymization
:param timeout: connection and read timeout, see
    https://requests.readthedocs.io/en/latest/user/advanced/?highlight=timeout#timeouts
:param stream: true if the results should be chunked into pieces (use for large data)
:return: repseudonymized data</p>

          <details class="quote">
            <summary>Source code in <code>dapla_pseudo/v1/ops.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">repseudonymize</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">FieldDecl</span><span class="p">],</span>
    <span class="n">source_key</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PseudoKeyset</span><span class="p">]</span> <span class="o">=</span> <span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span>
    <span class="n">target_key</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PseudoKeyset</span><span class="p">]</span> <span class="o">=</span> <span class="n">PredefinedKeys</span><span class="o">.</span><span class="n">SSB_COMMON_KEY_1</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TIMEOUT_DEFAULT</span><span class="p">,</span>
    <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Repseudonymize specified fields of a local, previously pseudonymized file.</span>

<span class="sd">    You will need to provide a crypto key for both the source data and a key that should be used for</span>
<span class="sd">    re-pseudonymization.</span>

<span class="sd">    Supported file formats: csv and json (both standard and &quot;new line delimited&quot; json)</span>

<span class="sd">    You can alternatively send a zip-file containing one or many files of the supported file formats. The pseudo service</span>
<span class="sd">    will unzip and process them sequentially. This can be handy if your file is large and/or split into multiple files.</span>

<span class="sd">    The ``fields`` list specifies what to repseudonymize. This can either be a plain vanilla list of field names (e.g.</span>
<span class="sd">    ``[&quot;some_field1&quot;, &quot;another_field2&quot;]``, or you can apply ninja-style techniques, such as using wildcard characters</span>
<span class="sd">    (e.g. *Name) or slashes to target hierarchical fields (e.g. **/path/to/hierarchicalStuff).</span>

<span class="sd">    Pseudonymize uses the tink-daead crypto function underneath the hood. It requires a key.</span>
<span class="sd">    You can choose to specify one of the predefined (&quot;globally available&quot;) keys (&quot;ssb-common-key-1&quot; or</span>
<span class="sd">    &quot;ssb-common-key-2&quot;) or provide your own custom keyset. If you don&#39;t specify a key, the predefined &quot;ssb-common-key-1&quot;</span>
<span class="sd">    will be used as default.</span>

<span class="sd">    It is possible to operate on the file in a streaming manner, e.g. like so:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        with repseudonymize(&quot;./data/personer-deid.json&quot;, fields=[&quot;fnr&quot;, &quot;fornavn&quot;, &quot;etternavn&quot;], stream=True) as res:</span>
<span class="sd">            with open(&quot;./data/personer.json&quot;, &#39;wb&#39;) as f:</span>
<span class="sd">                shutil.copyfileobj(res.raw, f)</span>

<span class="sd">    :param file_path: path to a local file, e.g. ./path/to/data.json. Supported file formats: csv, json</span>
<span class="sd">    :param fields: list of fields that should be pseudonymized</span>
<span class="sd">    :param source_key: either named reference to a &quot;global&quot; key or a keyset json - used for depseudonymization</span>
<span class="sd">    :param target_key: either named reference to a &quot;global&quot; key or a keyset json - used for pseudonymization</span>
<span class="sd">    :param timeout: connection and read timeout, see</span>
<span class="sd">        https://requests.readthedocs.io/en/latest/user/advanced/?highlight=timeout#timeouts</span>
<span class="sd">    :param stream: true if the results should be chunked into pieces (use for large data)</span>
<span class="sd">    :return: repseudonymized data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">_content_type_of</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">source_key_wrapper</span> <span class="o">=</span> <span class="n">KeyWrapper</span><span class="p">(</span><span class="n">source_key</span><span class="p">)</span>
    <span class="n">target_key_wrapper</span> <span class="o">=</span> <span class="n">KeyWrapper</span><span class="p">(</span><span class="n">target_key</span><span class="p">)</span>
    <span class="n">source_rules</span> <span class="o">=</span> <span class="n">_rules_of</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">sid_fields</span><span class="o">=</span><span class="p">[],</span> <span class="n">key</span><span class="o">=</span><span class="n">source_key_wrapper</span><span class="o">.</span><span class="n">key_id</span><span class="p">)</span>
    <span class="n">target_rules</span> <span class="o">=</span> <span class="n">_rules_of</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">sid_fields</span><span class="o">=</span><span class="p">[],</span> <span class="n">key</span><span class="o">=</span><span class="n">target_key_wrapper</span><span class="o">.</span><span class="n">key_id</span><span class="p">)</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">RepseudonymizeFileRequest</span><span class="p">(</span>
        <span class="n">source_pseudo_config</span><span class="o">=</span><span class="n">PseudoConfig</span><span class="p">(</span><span class="n">rules</span><span class="o">=</span><span class="n">source_rules</span><span class="p">,</span> <span class="n">keysets</span><span class="o">=</span><span class="n">source_key_wrapper</span><span class="o">.</span><span class="n">keyset_list</span><span class="p">()),</span>
        <span class="n">target_pseudo_config</span><span class="o">=</span><span class="n">PseudoConfig</span><span class="p">(</span><span class="n">rules</span><span class="o">=</span><span class="n">target_rules</span><span class="p">,</span> <span class="n">keysets</span><span class="o">=</span><span class="n">target_key_wrapper</span><span class="o">.</span><span class="n">keyset_list</span><span class="p">()),</span>
        <span class="n">target_content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
        <span class="n">target_uri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">_client</span><span class="p">()</span><span class="o">.</span><span class="n">repseudonymize_file</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>